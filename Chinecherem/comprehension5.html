<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reading Comprehension – Chinecherem Erinne</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
 --primary:#1e3a8a;
 --secondary:#2563eb;
 --accent:#0f766e;
 --card:#ffffff;
 --muted:#e5e7eb;
 --highlight:#fde68a;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
 font-family:"Segoe UI",system-ui,sans-serif;
 background:linear-gradient(135deg,#e0e7ff,#f8fafc);
 padding:14px;
}

.container{
 max-width:950px;
 margin:auto;
 background:var(--card);
 padding:22px;
 border-radius:18px;
 box-shadow:0 12px 35px rgba(0,0,0,.12);
}

h1{
 text-align:center;
 color:var(--primary);
 font-size:1.9rem;
 margin-bottom:14px;
}

/* Navigation */
.nav{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:10px;
 margin-bottom:20px;
}

.nav button{
 padding:10px;
 font-size:.9rem;
 border-radius:12px;
 border:none;
 color:#fff;
 font-weight:600;
 cursor:pointer;
}

.nav button:nth-child(1){background:#2563eb}
.nav button:nth-child(2){background:#0f766e}
.nav button:nth-child(3){background:#7c3aed}

button:active{transform:scale(.97)}

/* Dropdowns */
.select-wrap{
 max-width:240px;
 margin:0 auto 10px;
 text-align:center;
 font-weight:600;
}

select{
 width:100%;
 padding:8px 10px;
 font-size:.9rem;
 border-radius:10px;
 border:2px solid var(--muted);
 background:#fff;
}

/* Passage */
.subtitle{
 font-size:1.6rem;
 text-align:center;
 font-weight:600;
 margin:24px 0;
 color:#0f172a;
 line-height:2;
}

.subtitle span{
 padding:2px 4px;
 border-radius:4px;
}
button{
 padding:14px;
 font-size:16px;
 border-radius:12px;
 border:none;
 background:linear-gradient(to bottom,#3b82f6,#1e40af);
 color:#fff;
 font-weight:600;
 cursor:pointer;
}
.subtitle span.active{
 background:var(--highlight);
}

/* Read button */
.read-btn{
 display:block;
 margin:0 auto;
 padding:10px 18px;
 font-size:.9rem;
 background:#2563eb;
 color:#fff;
 border:none;
 border-radius:12px;
 font-weight:600;
 cursor:pointer;
}

/* Question card */
.question-card{
 border:2px solid var(--secondary);
 border-radius:18px;
 padding:18px;
 margin-top:18px;
 background:#f8fafc;
}

.question-card h3{
 font-size:1.1rem;
 margin-bottom:14px;
}

.option{
 display:flex;
 gap:10px;
 padding:12px;
 background:#fff;
 border-radius:14px;
 border:2px solid var(--muted);
 cursor:pointer;
 font-size:.95rem;
 margin-bottom:10px;
}

.option input{margin-top:4px}

.controls{
 display:flex;
 justify-content:flex-end;
 margin-top:14px;
}

.controls button{
 padding:10px 16px;
 font-size:.9rem;
 background:#0f766e;
 color:#fff;
 border:none;
 border-radius:12px;
 font-weight:600;
}

/* Score */
.score-box{
 text-align:center;
 font-size:2.2rem;
 font-weight:900;
 margin:30px 0;
 color:var(--accent);
}

/* Analytics */
.analytics{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:14px;
 margin-top:20px;
}

.analytics div{
 background:#eef2ff;
 padding:18px;
 border-radius:16px;
 text-align:center;
}

/* Table */
table{
 width:100%;
 border-collapse:collapse;
 margin-top:16px;
 font-size:.9rem;
}

th,td{
 padding:10px;
 border-bottom:1px solid var(--muted);
 text-align:center;
}

th{background:#e0e7ff}

.hidden{display:none}

@media(max-width:700px){
 .nav{grid-template-columns:1fr}
 .subtitle{font-size:1.3rem}
}
</style>
</head>

<body>
<div class="container">
<h1>Reading Comprehension - xtreme Weather</h1>

<div class="nav">
<button onclick="showTab('reading')">Reading</button>
<button onclick="showTab('analytics')">Progress Analytics</button>
<button onclick="showTab('results')">Previous Results</button>
</div>

<div id="readingTab">
<div class="select-wrap">
Voice
<select id="voiceSelect"></select>
</div>

<div class="select-wrap">
Difficulty
<select id="difficultySelect">
<option value="easy">Easy</option>
<option value="medium" selected>Medium</option>
<option value="hard">Hard</option>
</select>
</div>

<div class="subtitle" id="subtitle">Click “Read Story” to begin</div>
<button class="read-btn" onclick="readPassage()">Read Story</button>

<div id="quiz" class="hidden"></div>
<div id="score" class="score-box"></div>
</div>

<div id="analyticsTab" class="hidden">
<h2 style="text-align:center">Progress Analytics</h2>
<div class="analytics">
<div>Attempts<br><span id="totalAttempts">0</span></div>
<div>Best Score<br><span id="bestScore">0%</span></div>
<div>Average Score<br><span id="avgScore">0%</span></div>
</div>
</div>

<div id="resultsTab" class="hidden">
<h2 style="text-align:center">Previous Results</h2>
<table>
<thead>
<tr><th>Date</th><th>Difficulty</th><th>Score</th></tr>
</thead>
<tbody id="resultsTable"></tbody>
</table>
</div>
</div>

<script>
const STUDENT_NAME="Chinecherem Erinne";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyBgjLn8bw3xaIktJQxhisDnjGWv_GkJr8Y",
  authDomain: "compreh-8a519.firebaseapp.com",
  databaseURL: "https://compreh-8a519-default-rtdb.firebaseio.com",
  projectId: "compreh-8a519",
  storageBucket: "compreh-8a519.appspot.com",
  messagingSenderId: "46119679894",  // replace with your Firebase value if different
  appId: "1:46119679894:web:b5b870b047575d50a0cfb7"  // replace with your Firebase value if different
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the database
const db = firebase.database();


/* Tabs */
function showTab(t){
 ["reading","analytics","results"].forEach(x=>{
  document.getElementById(x+"Tab").classList.add("hidden");
 });
 document.getElementById(t+"Tab").classList.remove("hidden");
}

/* Voices */
speechSynthesis.onvoiceschanged=()=>{
 voiceSelect.innerHTML="";
 speechSynthesis.getVoices().filter(v=>v.lang.startsWith("en"))
 .forEach((v,i)=>{
  voiceSelect.innerHTML+=`<option value="${i}">${v.name}</option>`;
 });
};


/* Content */
const passages = {
  easy: [
    "One night, a strong storm hit the town. Rain poured heavily, and the wind blew loudly. Mia and her brother stayed inside their house, watching the trees sway. They listened to the thunder but felt safe with their parents. The next morning, the sun came out, and everything was calm again."
  ],

  medium: [
    "During a stormy night, Mia and her brother watched from their window as rain poured and wind shook the trees. Thunder roared in the sky, and lightning flashed across the clouds. Although the storm seemed scary, they felt protected inside with their parents. By morning, the storm had passed, leaving a calm and sunny day."
  ],

  hard: [
    "On a particularly stormy night, Mia and her brother observed from the safety of their home as sheets of rain fell and fierce winds battered the trees. Thunder echoed in the sky, accompanied by bright flashes of lightning. Despite the frightening weather, they remained secure with their parents. When dawn arrived, the storm had subsided, and sunlight returned to the town."
  ]
};

/* Questions */
const questions = {
  easy: [
    {q:"What happened during the night?", o:["A storm hit the town","A festival happened","School was closed","A parade passed by"], a:0},
    {q:"How did the wind blow?", o:["Loudly","Gently","Slowly","Silently"], a:0},
    {q:"Where were Mia and her brother?", o:["Inside their house","Outside in the rain","At school","In a shop"], a:0},
    {q:"How did they feel with their parents?", o:["Safe","Scared","Bored","Hungry"], a:0},
    {q:"What happened the next morning?", o:["The sun came out","The storm continued","They went swimming","It snowed"], a:0},
    {q:"The storm caused ______.", o:["Trees to sway","School to open","Parade to start","Rain to stop"], a:0},
    {q:"Thunder is described as ______.", o:["Loud","Silent","Tiny","Slow"], a:0},
    {q:"The story mainly teaches about ______.", o:["Storms and safety","Cooking","Travelling","Shopping"], a:0},
    {q:"Mia and her brother watched ______.", o:["The trees sway","TV","A movie","The neighbor"], a:0},
    {q:"The weather changed from night to morning by ______.", o:["Becoming calm and sunny","Getting worse","Snowing","Freezing"], a:0}
  ],

  medium: [
    {q:"Where did Mia and her brother watch the storm?", o:["From their window","From the park","From school","From the street"], a:0},
    {q:"What shook the trees?", o:["Wind","Thunder","Lightning","Rain"], a:0},
    {q:"What lit up the sky?", o:["Lightning","Fireworks","Sun","Lanterns"], a:0},
    {q:"How did they feel during the storm?", o:["Protected","Alone","Hungry","Tired"], a:0},
    {q:"When did the storm pass?", o:["By morning","At midnight","The next week","After an hour"], a:0},
    {q:"The stormy weather was described as ______.", o:["Fierce","Mild","Weak","Calm"], a:0},
    {q:"What does the story emphasize?", o:["Feeling safe during storms","Playing outside","Watching TV","Cooking"], a:0},
    {q:"Which event occurred first?", o:["The storm hit","Sun came out","They went to bed","School started"], a:0},
    {q:"Mia and her brother stayed ______.", o:["Inside with parents","Outside","At school","At a friend’s house"], a:0},
    {q:"The lesson from the story is about ______.", o:["Safety during bad weather","Travelling far","Winning games","Cleaning the house"], a:0}
  ],

  hard: [
    {q:"What kind of night was it?", o:["Stormy","Quiet","Snowy","Sunny"], a:0},
    {q:"How did the rain fall?", o:["In sheets","Drizzling","Sparsely","Slowly"], a:0},
    {q:"What accompanied thunder?", o:["Lightning","Fireworks","Birds","Fog"], a:0},
    {q:"How did Mia and her brother stay secure?", o:["With their parents","Alone outside","In the classroom","In the car"], a:0},
    {q:"What time did the storm end?", o:["By dawn","At midnight","After a week","At noon"], a:0},
    {q:"How did the town look after the storm?", o:["Sunny and calm","Flooded","Covered in snow","Busy"], a:0},
    {q:"The story mainly highlights ______.", o:["Safety and weather","Cooking","Traveling","Playing games"], a:0},
    {q:"Which word describes the storm?", o:["Fierce","Gentle","Tiny","Silent"], a:0},
    {q:"What did the children observe during the storm?", o:["Rain, wind, and lightning","School activities","TV shows","Visitors"], a:0},
    {q:"The moral of the story is about ______.", o:["Being safe during storms","Winning competitions","Cooking","Shopping"], a:0}
  ]
};



let difficulty,index,answers;

function readPassage(){
 difficulty=difficultySelect.value;
 index=0;answers=[];
 quiz.classList.add("hidden");
 score.innerText="";
 let lines=passages[difficulty],i=0;

 function speak(){
  if(i>=lines.length){startQuiz();return;}

  const words=lines[i].split(" ");
  subtitle.innerHTML=words.map(w=>`<span>${w}</span>`).join(" ");
  const spans=[...subtitle.querySelectorAll("span")];
  let wi=0;

  let u=new SpeechSynthesisUtterance(lines[i]);
  u.voice=speechSynthesis.getVoices()[voiceSelect.value];

  u.onboundary=e=>{
   if(e.name==="word"){
    spans.forEach(s=>s.classList.remove("active"));
    if(spans[wi]) spans[wi].classList.add("active");
    wi++;
   }
  };

  u.onend=()=>{i++;speak();};
  speechSynthesis.speak(u);
 }
 speak();
}

function startQuiz(){
 quiz.classList.remove("hidden");
 showQuestion();
}

function showQuestion(){
 let q=questions[difficulty][index];
 quiz.innerHTML=`
 <div class="question-card">
 <h3>${q.q}</h3>
 ${q.o.map((o,i)=>`
  <label class="option">
  <input type="radio" name="opt" value="${i}"> ${o}
  </label>`).join("")}
 <div class="controls">
 <button onclick="${index<questions[difficulty].length-1?'nextQuestion()':'submitQuiz()'}">
 ${index<questions[difficulty].length-1?'Next':'Submit'}
 </button>
 </div>
 </div>`;
}

function nextQuestion(){
 let s=document.querySelector("input[name='opt']:checked");
 if(!s){showModal(STUDENT_NAME+", please select an answer.");return;}
 answers.push(+s.value);
 index++;showQuestion();
}

function submitQuiz(){
 let s=document.querySelector("input[name='opt']:checked");
 if(!s){showModal(STUDENT_NAME+", please select an answer.");return;}
 answers.push(+s.value);

 let correct=answers.filter((v,i)=>v===questions[difficulty][i].a).length;
 let pct=Math.round(correct/answers.length*100);
 score.innerText=`Score: ${pct}%`;
 showModal(STUDENT_NAME+", your score is "+pct+"%");

 db.ref("results").push({student:STUDENT_NAME,difficulty,score:pct,timestamp:Date.now()});
 loadResults();
}

/* Results */
function loadResults(){
 db.ref("results").once("value",snap=>{
  let data=Object.values(snap.val()||{}).filter(r=>r.student===STUDENT_NAME);
  resultsTable.innerHTML="";
  let sum=0,best=0;
  data.forEach(r=>{
   sum+=r.score;best=Math.max(best,r.score);
   resultsTable.innerHTML+=`
   <tr><td>${new Date(r.timestamp).toLocaleString()}</td><td>${r.difficulty}</td><td>${r.score}%</td></tr>`;
  });
  totalAttempts.innerText=data.length;
  bestScore.innerText=best+"%";
  avgScore.innerText=data.length?Math.round(sum/data.length)+"%":"0%";
 });
}
loadResults();

/* CLEAN MODAL — NO AUTO CLOSE */
function showModal(message){
 const overlay=document.createElement("div");
 overlay.style=`position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:9999`;

 const box=document.createElement("div");
 box.style=`background:#fff;padding:28px;border-radius:16px;max-width:420px;width:90%;text-align:center`;

 box.innerHTML=`
 <h3 style="color:#1e3a8a;margin-bottom:10px">Message</h3>
 <p style="margin-bottom:20px">${message}</p>
 <button>OK</button>
 `;

 box.querySelector("button").onclick=()=>document.body.removeChild(overlay);
 overlay.appendChild(box);
 document.body.appendChild(overlay);
}
</script>
</body>
</html>
