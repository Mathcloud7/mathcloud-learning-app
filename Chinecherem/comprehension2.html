<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reading Comprehension – Chinecherem Erinne</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
 --primary:#1e3a8a;
 --secondary:#2563eb;
 --accent:#0f766e;
 --card:#ffffff;
 --muted:#e5e7eb;
 --highlight:#fde68a;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
 font-family:"Segoe UI",system-ui,sans-serif;
 background:linear-gradient(135deg,#e0e7ff,#f8fafc);
 padding:14px;
}

.container{
 max-width:950px;
 margin:auto;
 background:var(--card);
 padding:22px;
 border-radius:18px;
 box-shadow:0 12px 35px rgba(0,0,0,.12);
}

h1{
 text-align:center;
 color:var(--primary);
 font-size:1.9rem;
 margin-bottom:14px;
}

/* Navigation */
.nav{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:10px;
 margin-bottom:20px;
}

.nav button{
 padding:10px;
 font-size:.9rem;
 border-radius:12px;
 border:none;
 color:#fff;
 font-weight:600;
 cursor:pointer;
}

.nav button:nth-child(1){background:#2563eb}
.nav button:nth-child(2){background:#0f766e}
.nav button:nth-child(3){background:#7c3aed}

button:active{transform:scale(.97)}

/* Dropdowns */
.select-wrap{
 max-width:240px;
 margin:0 auto 10px;
 text-align:center;
 font-weight:600;
}

select{
 width:100%;
 padding:8px 10px;
 font-size:.9rem;
 border-radius:10px;
 border:2px solid var(--muted);
 background:#fff;
}

/* Passage */
.subtitle{
 font-size:1.6rem;
 text-align:center;
 font-weight:600;
 margin:24px 0;
 color:#0f172a;
 line-height:2;
}

.subtitle span{
 padding:2px 4px;
 border-radius:4px;
}
button{
 padding:14px;
 font-size:16px;
 border-radius:12px;
 border:none;
 background:linear-gradient(to bottom,#3b82f6,#1e40af);
 color:#fff;
 font-weight:600;
 cursor:pointer;
}
.subtitle span.active{
 background:var(--highlight);
}

/* Read button */
.read-btn{
 display:block;
 margin:0 auto;
 padding:10px 18px;
 font-size:.9rem;
 background:#2563eb;
 color:#fff;
 border:none;
 border-radius:12px;
 font-weight:600;
 cursor:pointer;
}

/* Question card */
.question-card{
 border:2px solid var(--secondary);
 border-radius:18px;
 padding:18px;
 margin-top:18px;
 background:#f8fafc;
}

.question-card h3{
 font-size:1.1rem;
 margin-bottom:14px;
}

.option{
 display:flex;
 gap:10px;
 padding:12px;
 background:#fff;
 border-radius:14px;
 border:2px solid var(--muted);
 cursor:pointer;
 font-size:.95rem;
 margin-bottom:10px;
}

.option input{margin-top:4px}

.controls{
 display:flex;
 justify-content:flex-end;
 margin-top:14px;
}

.controls button{
 padding:10px 16px;
 font-size:.9rem;
 background:#0f766e;
 color:#fff;
 border:none;
 border-radius:12px;
 font-weight:600;
}

/* Score */
.score-box{
 text-align:center;
 font-size:2.2rem;
 font-weight:900;
 margin:30px 0;
 color:var(--accent);
}

/* Analytics */
.analytics{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:14px;
 margin-top:20px;
}

.analytics div{
 background:#eef2ff;
 padding:18px;
 border-radius:16px;
 text-align:center;
}

/* Table */
table{
 width:100%;
 border-collapse:collapse;
 margin-top:16px;
 font-size:.9rem;
}

th,td{
 padding:10px;
 border-bottom:1px solid var(--muted);
 text-align:center;
}

th{background:#e0e7ff}

.hidden{display:none}

@media(max-width:700px){
 .nav{grid-template-columns:1fr}
 .subtitle{font-size:1.3rem}
}
</style>
</head>

<body>
<div class="container">
<h1>Reading Comprehension - The Mysterious Map</h1>

<div class="nav">
<button onclick="showTab('reading')">Reading</button>
<button onclick="showTab('analytics')">Progress Analytics</button>
<button onclick="showTab('results')">Previous Results</button>
</div>

<div id="readingTab">
<div class="select-wrap">
Voice
<select id="voiceSelect"></select>
</div>

<div class="select-wrap">
Difficulty
<select id="difficultySelect">
<option value="easy">Easy</option>
<option value="medium" selected>Medium</option>
<option value="hard">Hard</option>
</select>
</div>

<div class="subtitle" id="subtitle">Click “Read Story” to begin</div>
<button class="read-btn" onclick="readPassage()">Read Story</button>

<div id="quiz" class="hidden"></div>
<div id="score" class="score-box"></div>
</div>

<div id="analyticsTab" class="hidden">
<h2 style="text-align:center">Progress Analytics</h2>
<div class="analytics">
<div>Attempts<br><span id="totalAttempts">0</span></div>
<div>Best Score<br><span id="bestScore">0%</span></div>
<div>Average Score<br><span id="avgScore">0%</span></div>
</div>
</div>

<div id="resultsTab" class="hidden">
<h2 style="text-align:center">Previous Results</h2>
<table>
<thead>
<tr><th>Date</th><th>Difficulty</th><th>Score</th></tr>
</thead>
<tbody id="resultsTable"></tbody>
</table>
</div>
</div>

<script>
const STUDENT_NAME="Chinecherem Erinne";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyBjUeQfR0p0NpchswDBuwkSoF3nTY6zSYk",
  authDomain: "project2-1ff8f.firebaseapp.com",
  databaseURL: "https://project2-1ff8f-default-rtdb.firebaseio.com",
  projectId: "project2-1ff8f",
  storageBucket: "project2-1ff8f.appspot.com",
  messagingSenderId: "777989445334",
  appId: "1:777989445334:web:3dce814bb4d896d65f9b77"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the database
const db = firebase.database();


/* Tabs */
function showTab(t){
 ["reading","analytics","results"].forEach(x=>{
  document.getElementById(x+"Tab").classList.add("hidden");
 });
 document.getElementById(t+"Tab").classList.remove("hidden");
}

/* Voices */
speechSynthesis.onvoiceschanged=()=>{
 voiceSelect.innerHTML="";
 speechSynthesis.getVoices().filter(v=>v.lang.startsWith("en"))
 .forEach((v,i)=>{
  voiceSelect.innerHTML+=`<option value="${i}">${v.name}</option>`;
 });
};


/* Content */
const passages = {
  easy: [
    "Emma found an old map inside a library book. The map showed a park she knew well. Curious, Emma followed the path drawn on the paper. Near a big oak tree, she found a small box. Inside was a note that said, “Adventure begins with curiosity.”"
  ],

  medium: [
    "While reading in the school library, Emma discovered an old map hidden between book pages. The map showed landmarks from her town, including a park and a river. After school, she followed the clues carefully. Under a large oak tree, she uncovered a small box with a note about curiosity and courage."
  ],

  hard: [
    "During a quiet afternoon in the school library, Emma noticed a folded map tucked inside a worn book. The detailed drawings matched familiar places around her town. Determined to solve the mystery, she followed the trail step by step. Beneath an old oak tree, she uncovered a hidden box containing a message about curiosity, courage, and adventure."
  ]
};

/* Questions */
const questions = {
  easy: [
    {q:"Where did Emma find the map?", o:["At home","In a library book","On the ground","In her bag"], a:1},
    {q:"What place did the map show?", o:["A store","A park","A school","A house"], a:1},
    {q:"What kind of tree was on the map?", o:["Palm tree","Apple tree","Oak tree","Pine tree"], a:2},
    {q:"What did Emma find near the tree?", o:["A bench","A box","A bike","A ball"], a:1},
    {q:"What was inside the box?", o:["Money","Food","A note","A toy"], a:2},
    {q:"How did Emma feel about the map?", o:["Angry","Curious","Scared","Bored"], a:1},
    {q:"Where was Emma when she found the map?", o:["Park","Classroom","Library","Cafeteria"], a:2},
    {q:"The map helped Emma to ______.", o:["Sleep","Explore","Cook","Study"], a:1},
    {q:"What message was on the note?", o:["Be quiet","Adventure begins with curiosity","Do your homework","No entry"], a:1},
    {q:"Emma’s actions show ______.", o:["Fear","Confusion","Curiosity","Laziness"], a:2}
  ],

  medium: [
    {q:"Where did Emma discover the map?", o:["At home","In the school library","In the park","In class"], a:1},
    {q:"What was special about the map?", o:["It was colorful","It showed her town","It was torn","It was brand new"], a:1},
    {q:"When did Emma follow the map?", o:["At night","Before breakfast","After school","During class"], a:2},
    {q:"What landmarks were on the map?", o:["Ocean","Mall and store","Park and river","Mountains"], a:2},
    {q:"Where was the box hidden?", o:["By a river","Under an oak tree","On a bench","In a locker"], a:1},
    {q:"What was inside the box?", o:["A key","A coin","A note","A phone"], a:2},
    {q:"What idea did the note mention?", o:["Rules","Curiosity and courage","Silence","Speed and strength"], a:1},
    {q:"Why did Emma follow the map carefully?", o:["She was late","She wanted to solve the mystery","She was forced","She was lost"], a:1},
    {q:"The story is mainly about ______.", o:["Friendship","Competition","Exploration","Weather"], a:2},
    {q:"What trait did Emma show?", o:["Anger","Determination","Fear","Carelessness"], a:1}
  ],

  hard: [
    {q:"Where was the map tucked away?", o:["Under a desk","Inside a worn book","In a drawer","In a backpack"], a:1},
    {q:"What helped Emma recognize the places on the map?", o:["They were labeled","They were familiar","They were new","They were colorful"], a:1},
    {q:"How did Emma approach the mystery?", o:["By guessing","Step by step","By rushing","By ignoring clues"], a:1},
    {q:"Where did Emma uncover the box?", o:["Behind a bench","Near the river","Beneath an oak tree","Inside the library"], a:2},
    {q:"What was the box’s purpose?", o:["To hide money","To store food","To deliver a message","To lock something"], a:2},
    {q:"What qualities did the message highlight?", o:["Strength and speed","Luck","Curiosity and courage","Obedience"], a:2},
    {q:"What kind of day was it when Emma found the map?", o:["A stormy night","A quiet afternoon","A holiday","A busy morning"], a:1},
    {q:"Why was the book described as worn?", o:["It was heavy","It was old","It was dirty","It was missing pages"], a:1},
    {q:"What is the theme of the story?", o:["Winning prizes","Exploration and curiosity","Following rules","Avoiding risks"], a:1},
    {q:"What lesson can readers learn?", o:["Maps are dangerous","Libraries are boring","Curiosity can lead to adventure","Trees hide secrets"], a:2}
  ]
};




let difficulty,index,answers;

function readPassage(){
 difficulty=difficultySelect.value;
 index=0;answers=[];
 quiz.classList.add("hidden");
 score.innerText="";
 let lines=passages[difficulty],i=0;

 function speak(){
  if(i>=lines.length){startQuiz();return;}

  const words=lines[i].split(" ");
  subtitle.innerHTML=words.map(w=>`<span>${w}</span>`).join(" ");
  const spans=[...subtitle.querySelectorAll("span")];
  let wi=0;

  let u=new SpeechSynthesisUtterance(lines[i]);
  u.voice=speechSynthesis.getVoices()[voiceSelect.value];

  u.onboundary=e=>{
   if(e.name==="word"){
    spans.forEach(s=>s.classList.remove("active"));
    if(spans[wi]) spans[wi].classList.add("active");
    wi++;
   }
  };

  u.onend=()=>{i++;speak();};
  speechSynthesis.speak(u);
 }
 speak();
}

function startQuiz(){
 quiz.classList.remove("hidden");
 showQuestion();
}

function showQuestion(){
 let q=questions[difficulty][index];
 quiz.innerHTML=`
 <div class="question-card">
 <h3>${q.q}</h3>
 ${q.o.map((o,i)=>`
  <label class="option">
  <input type="radio" name="opt" value="${i}"> ${o}
  </label>`).join("")}
 <div class="controls">
 <button onclick="${index<questions[difficulty].length-1?'nextQuestion()':'submitQuiz()'}">
 ${index<questions[difficulty].length-1?'Next':'Submit'}
 </button>
 </div>
 </div>`;
}

function nextQuestion(){
 let s=document.querySelector("input[name='opt']:checked");
 if(!s){showModal(STUDENT_NAME+", please select an answer.");return;}
 answers.push(+s.value);
 index++;showQuestion();
}

function submitQuiz(){
 let s=document.querySelector("input[name='opt']:checked");
 if(!s){showModal(STUDENT_NAME+", please select an answer.");return;}
 answers.push(+s.value);

 let correct=answers.filter((v,i)=>v===questions[difficulty][i].a).length;
 let pct=Math.round(correct/answers.length*100);
 score.innerText=`Score: ${pct}%`;
 showModal(STUDENT_NAME+", your score is "+pct+"%");

 db.ref("results").push({student:STUDENT_NAME,difficulty,score:pct,timestamp:Date.now()});
 loadResults();
}

/* Results */
function loadResults(){
 db.ref("results").once("value",snap=>{
  let data=Object.values(snap.val()||{}).filter(r=>r.student===STUDENT_NAME);
  resultsTable.innerHTML="";
  let sum=0,best=0;
  data.forEach(r=>{
   sum+=r.score;best=Math.max(best,r.score);
   resultsTable.innerHTML+=`
   <tr><td>${new Date(r.timestamp).toLocaleString()}</td><td>${r.difficulty}</td><td>${r.score}%</td></tr>`;
  });
  totalAttempts.innerText=data.length;
  bestScore.innerText=best+"%";
  avgScore.innerText=data.length?Math.round(sum/data.length)+"%":"0%";
 });
}
loadResults();

/* CLEAN MODAL — NO AUTO CLOSE */
function showModal(message){
 const overlay=document.createElement("div");
 overlay.style=`position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:9999`;

 const box=document.createElement("div");
 box.style=`background:#fff;padding:28px;border-radius:16px;max-width:420px;width:90%;text-align:center`;

 box.innerHTML=`
 <h3 style="color:#1e3a8a;margin-bottom:10px">Message</h3>
 <p style="margin-bottom:20px">${message}</p>
 <button>OK</button>
 `;

 box.querySelector("button").onclick=()=>document.body.removeChild(overlay);
 overlay.appendChild(box);
 document.body.appendChild(overlay);
}
</script>
</body>
</html>
