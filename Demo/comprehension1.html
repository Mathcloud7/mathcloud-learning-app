<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reading Comprehension – Demo Student</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
 --primary:#1e3a8a;
 --secondary:#2563eb;
 --accent:#0f766e;
 --card:#ffffff;
 --muted:#e5e7eb;
 --highlight:#fde68a;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
 font-family:"Segoe UI",system-ui,sans-serif;
 background:linear-gradient(135deg,#e0e7ff,#f8fafc);
 padding:14px;
}

.container{
 max-width:950px;
 margin:auto;
 background:var(--card);
 padding:22px;
 border-radius:18px;
 box-shadow:0 12px 35px rgba(0,0,0,.12);
}

h1{
 text-align:center;
 color:var(--primary);
 font-size:1.9rem;
 margin-bottom:14px;
}

/* Navigation */
.nav{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:10px;
 margin-bottom:20px;
}

.nav button{
 padding:10px;
 font-size:.9rem;
 border-radius:12px;
 border:none;
 color:#fff;
 font-weight:600;
 cursor:pointer;
}

.nav button:nth-child(1){background:#2563eb}
.nav button:nth-child(2){background:#0f766e}
.nav button:nth-child(3){background:#7c3aed}

button:active{transform:scale(.97)}

/* Dropdowns */
.select-wrap{
 max-width:240px;
 margin:0 auto 10px;
 text-align:center;
 font-weight:600;
}

select{
 width:100%;
 padding:8px 10px;
 font-size:.9rem;
 border-radius:10px;
 border:2px solid var(--muted);
 background:#fff;
}

/* Passage */
.subtitle{
 font-size:1.6rem;
 text-align:center;
 font-weight:600;
 margin:24px 0;
 color:#0f172a;
 line-height:2;
}

.subtitle span{
 padding:2px 4px;
 border-radius:4px;
}
button{
 padding:14px;
 font-size:16px;
 border-radius:12px;
 border:none;
 background:linear-gradient(to bottom,#3b82f6,#1e40af);
 color:#fff;
 font-weight:600;
 cursor:pointer;
}
.subtitle span.active{
 background:var(--highlight);
}

/* Read button */
.read-btn{
 display:block;
 margin:0 auto;
 padding:10px 18px;
 font-size:.9rem;
 background:#2563eb;
 color:#fff;
 border:none;
 border-radius:12px;
 font-weight:600;
 cursor:pointer;
}

/* Question card */
.question-card{
 border:2px solid var(--secondary);
 border-radius:18px;
 padding:18px;
 margin-top:18px;
 background:#f8fafc;
}

.question-card h3{
 font-size:1.1rem;
 margin-bottom:14px;
}

.option{
 display:flex;
 gap:10px;
 padding:12px;
 background:#fff;
 border-radius:14px;
 border:2px solid var(--muted);
 cursor:pointer;
 font-size:.95rem;
 margin-bottom:10px;
}

.option input{margin-top:4px}

.controls{
 display:flex;
 justify-content:flex-end;
 margin-top:14px;
}

.controls button{
 padding:10px 16px;
 font-size:.9rem;
 background:#0f766e;
 color:#fff;
 border:none;
 border-radius:12px;
 font-weight:600;
}

/* Score */
.score-box{
 text-align:center;
 font-size:2.2rem;
 font-weight:900;
 margin:30px 0;
 color:var(--accent);
}

/* Analytics */
.analytics{
 display:grid;
 grid-template-columns:repeat(3,1fr);
 gap:14px;
 margin-top:20px;
}

.analytics div{
 background:#eef2ff;
 padding:18px;
 border-radius:16px;
 text-align:center;
}

/* Table */
table{
 width:100%;
 border-collapse:collapse;
 margin-top:16px;
 font-size:.9rem;
}

th,td{
 padding:10px;
 border-bottom:1px solid var(--muted);
 text-align:center;
}

th{background:#e0e7ff}

.hidden{display:none}

@media(max-width:700px){
 .nav{grid-template-columns:1fr}
 .subtitle{font-size:1.3rem}
}
</style>
</head>

<body>
<div class="container">
<h1>Reading Comprehension - The Lost Kitten</h1>

<div class="nav">
<button onclick="showTab('reading')">Reading</button>
<button onclick="showTab('analytics')">Progress Analytics</button>
<button onclick="showTab('results')">Previous Results</button>
</div>

<div id="readingTab">
<div class="select-wrap">
Voice
<select id="voiceSelect"></select>
</div>

<div class="select-wrap">
Difficulty
<select id="difficultySelect">
<option value="easy">Easy</option>
<option value="medium" selected>Medium</option>
<option value="hard">Hard</option>
</select>
</div>

<div class="subtitle" id="subtitle">Click “Read Story” to begin</div>
<button class="read-btn" onclick="readPassage()">Read Story</button>

<div id="quiz" class="hidden"></div>
<div id="score" class="score-box"></div>
</div>

<div id="analyticsTab" class="hidden">
<h2 style="text-align:center">Progress Analytics</h2>
<div class="analytics">
<div>Attempts<br><span id="totalAttempts">0</span></div>
<div>Best Score<br><span id="bestScore">0%</span></div>
<div>Average Score<br><span id="avgScore">0%</span></div>
</div>
</div>

<div id="resultsTab" class="hidden">
<h2 style="text-align:center">Previous Results</h2>
<table>
<thead>
<tr><th>Date</th><th>Difficulty</th><th>Score</th></tr>
</thead>
<tbody id="resultsTable"></tbody>
</table>
</div>
</div>

<script>
const STUDENT_NAME="Demo Student";

/* Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyAiT77KzMlRTi5LIz6bAk_MUM6iUlWIPQw",
  authDomain: "project1-4067d.firebaseapp.com",
  databaseURL: "https://project1-4067d-default-rtdb.firebaseio.com",
  projectId: "project1-4067d",
  storageBucket: "project1-4067d.appspot.com",
  messagingSenderId: "365793583410",
  appId: "1:365793583410:web:c2de9aac1c84d8e6ab772b"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);

// Get a reference to the database
const db = firebase.database();


/* Tabs */
function showTab(t){
 ["reading","analytics","results"].forEach(x=>{
  document.getElementById(x+"Tab").classList.add("hidden");
 });
 document.getElementById(t+"Tab").classList.remove("hidden");
}

/* Voices */
speechSynthesis.onvoiceschanged=()=>{
 voiceSelect.innerHTML="";
 speechSynthesis.getVoices().filter(v=>v.lang.startsWith("en"))
 .forEach((v,i)=>{
  voiceSelect.innerHTML+=`<option value="${i}">${v.name}</option>`;
 });
};


/* Content */ 
const passages = {
  easy: [
    "A young boy found a small lost kitten wandering in the park. The kitten looked nervous, so the boy spoke softly and gently picked it up. He walked around and asked people if they had seen its owner. Soon, a girl came running and hugged the kitten with relief."
  ],

  medium: [
    "A boy found a lost kitten near his school. The kitten wore a tiny collar but had no name tag. Even though he had homework, he felt responsible and decided to help. He made posters and asked neighbors if they recognized the kitten. By evening, the owner arrived and was grateful."
  ],

  hard: [
    "On his way home through a quiet path, a boy noticed a frightened kitten caught in some string behind a fence. The kitten meowed softly, asking for help. The boy stayed calm, carefully freed the kitten, and posted a message on the community board. Later, a thankful family arrived, and the kitten was reunited with its home."
  ]
};

/* Questions */
const questions = {
  easy: [
    {q:"What did the boy find in the park?", o:["A kitten","A book","A phone","A bag"], a:0},
    {q:"How did the boy treat the kitten?", o:["Gently","Roughly","Carelessly","Angrily"], a:0},
    {q:"Who came to get the kitten?", o:["A girl","A police officer","A teacher","A doctor"], a:0},
    {q:"Why was the girl relieved?", o:["She found her kitten","She won a prize","She finished homework","She bought food"], a:0},
    {q:"What feeling did the kitten show?", o:["Nervous","Excited","Angry","Sleepy"], a:0},
    {q:"What did the boy try to find?", o:["The owner","A toy","A bicycle","Food"], a:0},
    {q:"Where was the kitten found?", o:["In the park","In a house","In a car","In the classroom"], a:0},
    {q:"The boy spoke to the kitten very ______.", o:["Softly","Loudly","Rudely","Fast"], a:0},
    {q:"The kitten was described as ______.", o:["Lost","Huge","Dangerous","Wild"], a:0},
    {q:"The student’s action shows ______.", o:["Kindness","Jealousy","Competition","Fear"], a:0}
  ],

  medium: [
    {q:"Where did the boy find the kitten?", o:["Near school","At home","In class","In the market"], a:0},
    {q:"What was missing from the kitten’s collar?", o:["Name tag","Bell","Color","Ribbon"], a:0},
    {q:"Why did the boy feel responsible?", o:["The kitten was lost","He owned it","It was noisy","It was big"], a:0},
    {q:"How did he try to find the owner?", o:["By making posters","By ignoring it","By hiding it","By selling it"], a:0},
    {q:"Who recognized the kitten?", o:["The owner","A teacher","A stranger","No one"], a:0},
    {q:"How did the owner feel?", o:["Grateful","Angry","Confused","Afraid"], a:0},
    {q:"What else did the boy have to do that day?", o:["Homework","Shopping","Sports practice","Travel"], a:0},
    {q:"Why were the posters useful?", o:["They shared information","They decorated walls","They were colorful","They were funny"], a:0},
    {q:"The kitten story is mostly about ______.", o:["Kindness","Competition","Travel","Magic"], a:0},
    {q:"What skill did the boy show?", o:["Responsibility","Speed","Strength","Luck"], a:0}
  ],

  hard: [
    {q:"Where was the frightened kitten trapped?", o:["Behind a fence","In a cave","In a park","In a house"], a:0},
    {q:"What was wrapped around the kitten?", o:["String","Rope","Tape","Ribbon"], a:0},
    {q:"How did the boy react?", o:["Calmly","Angrily","Confused","Carelessly"], a:0},
    {q:"What did he post on the community board?", o:["A message","A drawing","A complaint","A map"], a:0},
    {q:"Who arrived later?", o:["A thankful family","Police","A doctor","Friends"], a:0},
    {q:"What happened to the kitten at the end?", o:["It was reunited with its home","It stayed lost","It ran away","It was sold"], a:0},
    {q:"The main theme of this story is ______.", o:["Responsibility and kindness","Winning a race","Solving math problems","Traveling"], a:0},
    {q:"Why did the kitten meow softly?", o:["It needed help","It was angry","It was sleepy","It was hunting"], a:0},
    {q:"What showed the boy cared?", o:["He freed the kitten","He ignored it","He scared it","He left it"], a:0},
    {q:"What tool helped find the owner?", o:["Community message","Boat","Map","Walkie-talkie"], a:0}
  ]
};



let difficulty,index,answers;

function readPassage(){
 difficulty=difficultySelect.value;
 index=0;answers=[];
 quiz.classList.add("hidden");
 score.innerText="";
 let lines=passages[difficulty],i=0;

 function speak(){
  if(i>=lines.length){startQuiz();return;}

  const words=lines[i].split(" ");
  subtitle.innerHTML=words.map(w=>`<span>${w}</span>`).join(" ");
  const spans=[...subtitle.querySelectorAll("span")];
  let wi=0;

  let u=new SpeechSynthesisUtterance(lines[i]);
  u.voice=speechSynthesis.getVoices()[voiceSelect.value];

  u.onboundary=e=>{
   if(e.name==="word"){
    spans.forEach(s=>s.classList.remove("active"));
    if(spans[wi]) spans[wi].classList.add("active");
    wi++;
   }
  };

  u.onend=()=>{i++;speak();};
  speechSynthesis.speak(u);
 }
 speak();
}

function startQuiz(){
 quiz.classList.remove("hidden");
 showQuestion();
}

function showQuestion(){
 let q=questions[difficulty][index];
 quiz.innerHTML=`
 <div class="question-card">
 <h3>${q.q}</h3>
 ${q.o.map((o,i)=>`
  <label class="option">
  <input type="radio" name="opt" value="${i}"> ${o}
  </label>`).join("")}
 <div class="controls">
 <button onclick="${index<questions[difficulty].length-1?'nextQuestion()':'submitQuiz()'}">
 ${index<questions[difficulty].length-1?'Next':'Submit'}
 </button>
 </div>
 </div>`;
}

function nextQuestion(){
 let s=document.querySelector("input[name='opt']:checked");
 if(!s){showModal(STUDENT_NAME+", please select an answer.");return;}
 answers.push(+s.value);
 index++;showQuestion();
}

function submitQuiz(){
 let s=document.querySelector("input[name='opt']:checked");
 if(!s){showModal(STUDENT_NAME+", please select an answer.");return;}
 answers.push(+s.value);

 let correct=answers.filter((v,i)=>v===questions[difficulty][i].a).length;
 let pct=Math.round(correct/answers.length*100);
 score.innerText=`Score: ${pct}%`;
 showModal(STUDENT_NAME+", your score is "+pct+"%");

 db.ref("results").push({student:STUDENT_NAME,difficulty,score:pct,timestamp:Date.now()});
 loadResults();
}

/* Results */
function loadResults(){
 db.ref("results").once("value",snap=>{
  let data=Object.values(snap.val()||{}).filter(r=>r.student===STUDENT_NAME);
  resultsTable.innerHTML="";
  let sum=0,best=0;
  data.forEach(r=>{
   sum+=r.score;best=Math.max(best,r.score);
   resultsTable.innerHTML+=`
   <tr><td>${new Date(r.timestamp).toLocaleString()}</td><td>${r.difficulty}</td><td>${r.score}%</td></tr>`;
  });
  totalAttempts.innerText=data.length;
  bestScore.innerText=best+"%";
  avgScore.innerText=data.length?Math.round(sum/data.length)+"%":"0%";
 });
}
loadResults();

/* CLEAN MODAL — NO AUTO CLOSE */
function showModal(message){
 const overlay=document.createElement("div");
 overlay.style=`position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;align-items:center;justify-content:center;z-index:9999`;

 const box=document.createElement("div");
 box.style=`background:#fff;padding:28px;border-radius:16px;max-width:420px;width:90%;text-align:center`;

 box.innerHTML=`
 <h3 style="color:#1e3a8a;margin-bottom:10px">Message</h3>
 <p style="margin-bottom:20px">${message}</p>
 <button>OK</button>
 `;

 box.querySelector("button").onclick=()=>document.body.removeChild(overlay);
 overlay.appendChild(box);
 document.body.appendChild(overlay);
}
</script>
</body>
</html>
